<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Buyer Dashboard</title>

  <!-- Jika kamu perlu auth.js, silakan tetap pakai -->
  <script src="/frontend/script/auth.js" defer></script>

  <!-- Tailwind CSS -->
  <link href="/frontend/src/output.css" rel="stylesheet">

  <!-- Google Font -->
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
    rel="stylesheet"
  >

  <!-- Font Awesome -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
  >

  <style>
    body {
      font-family: 'Inter', sans-serif;
    }

    @media (max-width: 768px) {
      .sidebar {
        display: none;
      }
    }
  </style>
</head>
<body class="bg-gray-50">
  <!-- Ganti "flex h-screen overflow-hidden" menjadi hanya "flex" -->
  <div class="flex">
    <!-- Sidebar -->
    <div class="sidebar hidden md:flex md:flex-shrink-0">
      <div class="flex flex-col w-64 bg-white border-r">
        <div class="flex items-center justify-center h-16 border-b">
          <div class="h-16 flex items-center justify-center border-b">
            <a href="dashboard-product.html">
              <img
                src="/frontend/assets/images/logo1.svg"
                alt="Logo CS NOTESelling"
                class="h-8 w-auto"
              />
            </a>
          </div>
        </div>

        <div class="flex flex-col flex-grow overflow-y-auto">
          <nav class="flex-1 px-2 py-4 space-y-1">
            <a
              href="#"
              class="flex items-center px-4 py-3 text-sm font-medium text-white bg-indigo-600 rounded-md"
            >
              <i class="fas fa-th-large mr-3"></i>
              Dashboard
            </a>
            <a
              href="dashboard-product.html"
              class="flex items-center px-4 py-3 text-sm font-medium text-gray-600 hover:bg-gray-100 rounded-md"
            >
              <i class="fas fa-box mr-3"></i>
              Products
            </a>
            <a
              href="wallet-buyer.html"
              class="flex items-center px-4 py-3 text-sm font-medium text-gray-600 hover:bg-gray-100 rounded-md"
            >
              <i class="fas fa-wallet mr-3"></i>
              Wallet
            </a>
            <a
              href="cart.html"
              class="flex items-center px-4 py-3 text-sm font-medium text-gray-600 hover:bg-gray-100 rounded-md"
            >
              <i class="fas fa-shopping-cart mr-3"></i>
              My Orders
            </a>
            <a
              href="#"
              class="flex items-center px-4 py-3 text-sm font-medium text-gray-600 hover:bg-gray-100 rounded-md"
            >
              <i class="fas fa-cog mr-3"></i>
              Settings
            </a>
          </nav>
          <div class="p-4 border-t">
            <div class="flex items-center">
              <img
                class="h-10 w-10 rounded-full"
                src="https://randomuser.me/api/portraits/women/42.jpg"
                alt="User avatar"
              />
              <div class="ml-3">
                <p class="text-sm font-medium text-gray-900">Sarah Buyer</p>
                <a
                  href="profile.html"
                  class="text-xs font-medium text-gray-500 hover:text-gray-700"
                >
                  View Profile
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- End Sidebar -->

    <!-- Main Content -->
    <!-- Hapus "overflow-hidden" agar tombol bisa diklik -->
    <div class="flex flex-col flex-1">
      <!-- Top Navigation -->
      <header class="bg-white shadow">
        <div class="flex items-center justify-between px-6 py-4">
          <div class="flex items-center md:hidden">
            <button
              type="button"
              class="text-gray-500 hover:text-gray-600 focus:outline-none"
            >
              <i class="fas fa-bars"></i>
            </button>
          </div>

          <div class="flex-1 flex justify-center md:justify-end">
            <div class="relative w-full max-w-md">
              <input
                type="text"
                placeholder="Search course..."
                class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
              >
              <button
                type="button"
                class="absolute inset-y-0 right-0 pr-3 flex items-center"
              >
                <i class="fas fa-search text-gray-400"></i>
              </button>
            </div>
          </div>

          <div class="ml-4 flex items-center md:ml-6">
            <button
              type="button"
              class="p-1 rounded-full text-gray-500 hover:text-gray-600 focus:outline-none relative"
            >
              <i class="fas fa-bell"></i>
              <span
                class="absolute top-0 right-0 block h-2 w-2 rounded-full bg-red-500"
              ></span>
            </button>
            <button
              type="button"
              onclick="window.location.href='cart.html'"
              class="p-1 ml-3 rounded-full text-gray-500 hover:text-gray-600 focus:outline-none relative"
            >
              <i class="fas fa-shopping-cart"></i>
              <span
                class="absolute top-0 right-0 block h-2 w-2 rounded-full bg-red-500"
              ></span>
            </button>
          </div>
        </div>
      </header>
      <!-- End Top Navigation -->

      <!-- Dashboard Content -->
      <main class="flex-1 p-6">
        <div class="mb-6">
          <h1 class="text-2xl font-semibold text-gray-900">Halo, Sarah!</h1>
          <p class="text-sm text-gray-600">
            Temukan catatan terbaik untuk menunjang kemampuan akademikmu!
          </p>
        </div>

        <!-- Quick Stats -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
          <div class="bg-white rounded-xl shadow p-6">
            <div class="flex items-center">
              <div class="p-3 rounded-full bg-indigo-100 text-indigo-600">
                <i class="fas fa-shopping-bag"></i>
              </div>
              <div class="ml-4">
                <p class="text-sm font-medium text-gray-500">Recent Orders</p>
                <p class="text-2xl font-semibold text-gray-900">5</p>
              </div>
            </div>
            <div class="mt-4">
              <a
                href="#"
                class="text-sm font-medium text-indigo-600 hover:text-indigo-500"
                >View Orders →</a
              >
            </div>
          </div>

          <div class="bg-white rounded-xl shadow p-6">
            <div class="flex items-center">
              <div class="p-3 rounded-full bg-green-100 text-green-600">
                <i class="fas fa-heart"></i>
              </div>
              <div class="ml-4">
                <p class="text-sm font-medium text-gray-500">Wishlist</p>
                <p class="text-2xl font-semibold text-gray-900">12</p>
              </div>
            </div>
            <div class="mt-4">
              <a
                href="#"
                class="text-sm font-medium text-indigo-600 hover:text-indigo-500"
                >View Wishlist →</a
              >
            </div>
          </div>

          <div class="bg-white rounded-xl shadow p-6">
            <div class="flex items-center">
              <div class="p-3 rounded-full bg-purple-100 text-purple-600">
                <i class="fas fa-gift"></i>
              </div>
              <div class="ml-4">
                <p class="text-sm font-medium text-gray-500">Reward Points</p>
                <p class="text-2xl font-semibold text-gray-900">250</p>
              </div>
            </div>
            <div class="mt-4">
              <a
                href="#"
                class="text-sm font-medium text-indigo-600 hover:text-indigo-500"
                >Redeem Points →</a
              >
            </div>
          </div>
        </div>
        <!-- End Quick Stats -->

        <!-- Special Offers -->
        <div class="mb-6">
          <h2 class="text-lg font-semibold text-gray-900 mb-4">Special Offers</h2>
          <div class="bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl shadow overflow-hidden">
            <div class="p-6 md:p-8 text-white">
              <h3 class="text-xl font-bold mb-2">Summer Sale!</h3>
              <p class="mb-4">
                Get up to 40% off on selected items. Limited time offer.
              </p>
              <button
                type="button"
                onclick="window.location.href='dashboard-product.html'"
                class="px-4 py-2 bg-white text-indigo-600 rounded-md font-medium text-sm"
              >
                Shop Now
              </button>
            </div>
          </div>
        </div>
        <!-- End Special Offers -->

        <!-- Recommended For You -->
        <div class="mb-6">
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-lg font-semibold text-gray-900">Recommended For You</h2>
            <a
              href="dashboard-product.html"
              class="text-sm font-medium text-indigo-600 hover:text-indigo-500"
              >View All</a
            >
          </div>
          <div id="recommended-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
            <!-- Produk rekomendasi akan di-inject via JavaScript -->
          </div>
        </div>
      </main>
      <!-- End Dashboard Content -->
    </div>
    <!-- End Main Content -->
  </div>

  <!-- Script loadRecommended di bagian paling bawah -->
  <script>
    // Fungsi untuk memuat data rekomendasi dari backend
    async function loadRecommended() {
      try {
        const response = await fetch('http://localhost:5000/api/dbuyerrecommend/recommended');
        const data = await response.json();
        console.log("Recommended Products:", data);

        const container = document.getElementById('recommended-list');
        if (!container) {
          console.error("Elemen dengan id='recommended-list' tidak ditemukan!");
          return;
        }
        container.innerHTML = "";

        data.forEach((item) => {
          const card = document.createElement('div');
          card.className = "bg-white rounded-xl shadow overflow-hidden";

          card.innerHTML = `
            <div class="relative">
              <img
                src="${item.image || 'https://hellocharliebooks.com/wp-content/uploads/2024/04/artificial-intelligence-copyrights-amazon.webp'}"
                alt="${item.materi}"
                class="w-full h-48 object-cover"
              >
              <button
                type="button"
                class="absolute top-3 right-3 p-1.5 rounded-full bg-white text-gray-900 hover:text-indigo-600"
              >
                <i class="fas fa-heart"></i>
              </button>
            </div>
            <div class="p-4">
              <h3 class="text-sm font-medium text-gray-900 mb-1">${item.materi}</h3>
              <p class="text-sm text-gray-500 mb-2">${item.title}</p>
              <p class="text-sm text-gray-900 mb-2">Rp ${item.price}</p>
              <button
                type="button"
                class="add-to-cart mt-4 w-full bg-indigo-600 text-white rounded-md py-2 text-sm font-medium hover:bg-indigo-700"
                data-materi="${item.materi}"
                data-title="${item.title}"
                data-price="${item.price}"
                data-image="${item.image || 'https://via.placeholder.com/300x200'}"
              >
                Add to Cart
              </button>
            </div>
          `;
          container.appendChild(card);
        });

        // Event listener untuk tombol Add to Cart
        const addToCartButtons = container.querySelectorAll(".add-to-cart");
        addToCartButtons.forEach((btn) => {
          btn.addEventListener("click", (e) => {
            e.preventDefault();

            const materi = btn.getAttribute("data-materi");
            const title = btn.getAttribute("data-title");
            const priceText = btn.getAttribute("data-price") || "0";
            const image = btn.getAttribute("data-image") || "";
            const priceNum = parseFloat(priceText.replace(/[^\d.]/g, "")) || 0;

            let cart = JSON.parse(localStorage.getItem("cart")) || [];
            const existingIndex = cart.findIndex(i => i.materi === materi);

            if (existingIndex !== -1) {
              // Kalau item sudah ada di cart, tambah quantity
              cart[existingIndex].quantity += 1;
            } else {
              // Item baru
              cart.push({
                materi,
                title,
                price: priceNum,
                image,
                quantity: 1
              });
            }

            localStorage.setItem("cart", JSON.stringify(cart));
            console.log("Cart Updated:", cart);

            // Jika mau langsung ke cart, uncomment baris ini:
            // window.location.href = "/frontend/pages/cart.html";
          });
        });
      } catch (error) {
        console.error("Error fetching recommended products:", error);
      }
    }

    // Panggil loadRecommended saat DOM siap
    window.addEventListener("DOMContentLoaded", loadRecommended);
  </script>
</body>
</html>